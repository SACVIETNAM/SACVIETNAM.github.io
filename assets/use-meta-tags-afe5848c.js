import{r as i}from"./index-ad7ff6c0.js";const b=t=>!!t,q={meta:["charset","name","property","http-equiv"],link:["rel","sizes"]},f=t=>e=>{const n=q[t].concat("id").map(a=>e.hasOwnProperty(a)?{key:a,value:e[a]}:void 0).filter(b),r=Object.keys(e).map(a=>({key:a,value:e[a]}));return{tag:t,query:n.length?n:r,attributes:e}},g=f("meta"),S=f("link"),m=({title:t,description:e,lang:s,charset:n,metas:r=[],links:a=[],openGraph:l={},twitter:d={}})=>{const T=r.map(g),E=a.map(S),I=Object.keys(l).map(c=>g({property:`og:${c}`,content:l[c]})),M=Object.keys(d).map(c=>g({property:`twitter:${c}`,content:d[c]})),v=[!!e&&{tag:"meta",query:[{key:"name",value:"description"}],attributes:{name:"description",content:e}},!!n&&{tag:"meta",query:[{key:"charset"}],attributes:{charset:n}},...T,...E,...I,...M].filter(b).filter(c=>c.query.length).reduce((c,u)=>{const w=u.query.map(({key:j="",value:k=""})=>`${j}=${k}`).join("~"),O=`${u.tag}_${w}`;return Object.assign(Object.assign({},c),{[O]:u})},{});return{title:t,lang:s,tags:v}};class ${constructor(){this.store=new Map,this.mergedMetatags={tags:{}},this.subscribers=new Set}registerInstance(e,s){return this.store.has(e)||this.store.set(e,{instanceTs:s}),()=>{this.store.delete(e),this.saveAndEmit()}}setInstanceMetaTags(e,s){const n=this.store.get(e);n&&(this.store.set(e,Object.assign(Object.assign({},n),{metaTagsModel:s})),this.saveAndEmit())}clear(){this.store.clear(),this.saveAndEmit()}getState(){return this.mergedMetatags}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}saveAndEmit(){this.mergedMetatags=this.mergeStoreInstances(),this.subscribers.forEach(e=>e(this.mergedMetatags))}mergeStoreInstances(){return Array.from(this.store.values()).filter(e=>!!e.metaTagsModel).sort((e,s)=>e.instanceTs-s.instanceTs).reduce((e,{metaTagsModel:s})=>{var n,r;return{title:(n=s.title)!==null&&n!==void 0?n:e.title,lang:(r=s.lang)!==null&&r!==void 0?r:e.lang,tags:Object.assign(Object.assign({},e.tags),s.tags)}},{tags:{}})}}const o=new $,L=(t,e)=>Object.keys(e.tags||{}).filter(s=>!t.tags[s]).map(s=>e.tags[s]),C=t=>Object.keys(t.tags||{}).map(e=>t.tags[e]),y=(t,e)=>{const s=e.reduce((n,{key:r,value:a})=>n+`[${r}${a?'="'+a+'"':""}]`,"");return document.head.querySelector(t+s)},H=t=>{const e=document.createElement(t);return document.head.appendChild(e),e},Q=t=>{document.title=t},A=t=>{document.documentElement.lang=t},K=({tag:t,query:e,attributes:s})=>{const n=y(t,e)||H(t);s&&Object.keys(s).forEach(r=>{n.setAttribute(r,s[r]||"")})},R=({tag:t,query:e})=>{const s=y(t,e);s&&document.head.removeChild(s)};let h,p={tags:{}};const _=(t,e)=>{typeof window<"u"&&(window.clearTimeout(h),h=setTimeout(()=>{const s=L(t,p),n=C(t);p=t,t.title&&Q(t.title),t.lang&&A(t.lang),n.forEach(K),s.forEach(R)},e))};o.subscribe(t=>_(t,50));const z=(t,e)=>{const s=i.useRef(Symbol()),n=i.useRef(Date.now());typeof window>"u"&&(o.registerInstance(s.current,n.current),o.setInstanceMetaTags(s.current,m(t))),i.useEffect(()=>{const r=o.registerInstance(s.current,n.current);return()=>{r()}},[]),i.useEffect(()=>{const r=m(t);o.setInstanceMetaTags(s.current,r)},[e])};export{z as u};
